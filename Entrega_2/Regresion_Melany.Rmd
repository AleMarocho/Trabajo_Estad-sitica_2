---
title: "E2"
author: "Mayeli, Melany y Alessandra"
date: "2022-10-06"
output: html_document
---

MELANY RODRIGUEZ

### Variable Dependiente: 

1. Base

```{r}
library("rio")
desi=import("https://github.com/AleMarocho/Trabajo_Estadistica_2/blob/main/Data/var_dependiente.xls?raw=true")
```

2. Renombrar indice

```{r}
colnames(desi) [2] = "Country"
colnames(desi) [26] = "GI"
names(desi)
```

3. Eliminar columnas innecesarias (solo con 2013)

```{r}
library(dplyr)
```

```{r}
DI = select(desi, contains ("Country"), contains ("GI"))
head(DI)
```
```{r}
DI<- filter(DI, !is.na(DI$GI))
```

```{r}
DI = DI[-c(142:154),]
```

```{r}
head(DI)
```

### Variables independientes: 

#VARIABLE INDEPENDIENTE 1 -- ÍNDICE DE DEMOCRACIA 

```{r}
library("rio")
demo=import("https://github.com/AleMarocho/Trabajo_Estadistica_2/raw/main/Data/DATA_MELANY/democracy_index.csv")
```

```{r}
colnames(demo) [1] = "Country"
names(demo)
```
```{r}
colnames(demo) [2] = "ID"
```

```{r}
library(dplyr)
demo = select(demo, contains ("Country"), contains ("ID"))
```

```{r}
demo<- filter(demo, !is.na(demo$ID))
```

```{r}
head(demo)
```

```{r}
demgi=merge(DI,demo)
str(demgi)
```
```{r}
demgi$GI=as.numeric(demgi$GI)
demgi$ID=as.numeric(demgi$ID)
```

GI=GENDER INEQUALITY
ID=INDEX DEMOCRACY

##REGRESIÓN 1

Hipótesis
- A mayor índice de democracia, menor sera el índice de desigualdad de género

```{r}
regresion1 <- lm(GI ~ ID, data = demgi)
summary(regresion1)
```

```{r}
library(stargazer)
stargazer(regresion1, type="text")
```

```{r}
library(knitr)
library(modelsummary)
model1=list('OLS asegurados (I)'=regresion1)
modelsummary(model1, title = "Regresion Lineal 1",
             stars = TRUE,
             output = "kableExtra")
```


#INTERPRETACION 1-REGRESION INDEX DEMOCRACY
La variable ID tiene efecto, es significatico, evidenciado por los asteriscos. El efecto es indirecto ya que el coeficiente es negativo, por lo que a mayor indice de democracia, menor sera el indice de desigualdad de genero. La magnitud del efecto es 
0.057, es decir la desigualdad de genero aumenta en 0.057 en promedio cuando el indice de democracia aumenta en una unidad. 
En cuanto al modelo el porcentaje de explicacion es de 36.2%, medido a traves del R2 ajustado. El p-valor de la variable index democracy es 1.43e-13, lo cual es menor a 0.05 y evidencia que el modelo es valido. La hipotesis se ve corroborada

La relacion se ve representada en el siguiente grafico:
- Los datos estan, en su mayoría dispersos, pero con una mayor cantidad en torno a valores entre 5.6 y 8, valores relativamente mayores de indice de democracia suelen tener una tendencia a valores menores de índice de desigualdad de genéro.

- En otras palabras, mientras mayor sea el índice de democracia, menor seran las probabilidades de que se evidencie desigualdad de genero en el pais respectivo. Por lo que decirmos que esta variable impacta significativamente con un 36.2%.


```{r}
ggplot(demgi, aes(x=ID, y=GI)) + 
  geom_point()+
  geom_smooth(method=lm)
```


#VARIABLE INDEPENDIENTE 2 -- ÍNDICE DE CRECIMIENTO ECONÓMICO 

```{r}
library("rio")
creci=import("https://github.com/AleMarocho/Trabajo_Estadistica_2/raw/main/Data/DATA_MELANY/crecimiento_economico.csv")
```

```{r}
colnames(creci) [1] = "Country"
colnames(creci) [35] = "Growth"
names(creci)
```

```{r}
library(dplyr)
creci= select(creci, contains ("Country"), contains ("Growth"))
```

```{r}
creci = creci[-c(1:2, 199:232),]
```

```{r}
creci<- filter(creci, !is.na(creci$Growth))
```

```{r}
head(creci)
```
```{r}
cregi=merge(DI,creci)
str(cregi)
```

```{r}
cregi$GI=as.numeric(cregi$GI)
cregi$Growth=as.numeric(cregi$Growth)
```

##REGRESION 2
Hipótesis
- A mayor índice de crecimiento economico, mayor sera el índice de desigualdad de género

```{r}
regresion2 <- lm(GI ~ Growth, data = cregi)
summary(regresion2)
```

```{r}
stargazer(regresion2, type="text")
```

```{r}
model2=list('OLS asegurados (I)'=regresion2)
modelsummary(model2, title = "Regresion Lineal 2",
             stars = TRUE,
             output = "kableExtra")
```

#INTERPRETACION 2-REGRESION ECONOMIC GROWTH
La variable crecimiento economico tiene efecto, es decir, es significatico, ello evidenciado por los asteriscos (***). El efecto es directo debido a que el coeficiente es positivo. Con ello, la hipotesis se ve corroborada, a mayor indice de crecimiento economico, mayor sera el indice de desigualdad de genero. La magnitud del efecto es 0.016, es decir la desigualdad de genero aumenta en 0.016 en promedio cuando el indice de crecimiento economico aumenta en una unidad. 
En cuanto al modelo el porcentaje de explicacion es de 15.4%, medido a traves del R2 ajustado. El p-valor de la independiente es 2.47e-08, lo cual es menor a 0.05 y evidencia que el modelo es valido. 

Grafico de explicacion de la relacion:
- Los datos estan concentrados en un lugar especifico, con una mayor cantidad en torno a valores entre 0 y 10, Se evidencia una tendencia ascendente, de relación directa, es decir, valores relativamente mayores de índice de crecimiento económico suelen tener una tendencia a valores mayores de índice de desigualdad de genéro.

- En otras palabras, mientras mayor sea el índice de crecimiento económico, mayores será la indice de desigualdad social en el pais respectivo. Por lo que decirmos que esta variable impacta significativamente, sin embargo con un 15,4% de significancia.

```{r}
ggplot(cregi, aes(x=Growth, y=GI)) + 
  geom_point()+
  geom_smooth(method=lm)
```

VARIABLE INDEPENDIENTE 3 -- PORCENTAJE DE NO AFILIADOS A RELIGIÓN ALGUNA

```{r}
library("rio")
afi=import("https://github.com/AleMarocho/Trabajo_Estadistica_2/raw/main/Data/DATA_MELANY/porcentaje_de_no_afiliados.csv")
```

```{r}
library(dplyr)
afi = select(afi, contains ("Country"), contains ("Unaffiliated"))
```

```{r}
afi$Unaffiliated=str_extract_all(afi$Unaffiliated,
"(\\-*\\d+\\.*\\d*)(?=\\%)",
simplify = T)
```

```{r}
afi$Unaffiliated=as.numeric(afi$Unaffiliated)
```

```{r}
afi$Unaffiliated=afi$Unaffiliated/100
```

```{r}
afigi=merge(DI,afi)
str(afigi)
```

```{r}
afigi$GI=as.numeric(afigi$GI)
```

##REGRESION 3
Hipótesis
- A mayor porcentaje de inafiliados, menor sera el índice de desigualdad de género

```{r}
regresion3 <- lm(GI ~ Unaffiliated, data = afigi)
summary(regresion3)
```

```{r}
library(stargazer)
stargazer(regresion3, type="text")
```

```{r}
model3=list('OLS asegurados (I)'=regresion3)
modelsummary(model3, title = "Regresion Lineal 3",
             stars = TRUE,
             output = "kableExtra")
```

#INTERPRETACION 3-REGRESION UNAFFILIATED

La variable no afiliados tiene efecto, es decir, es significatico, ello evidenciado por los asteriscos (***). El efecto es inverso debido a que el coeficiente es negativo. Con ello, la hipotesis se ve corroborada, a mayor porcentaje de no afiliados, menor sera el indice de desigualdad de genero. La magnitud del efecto es 0.674, es decir la desigualdad de genero aumenta en 0.674 en promedio cuando el indice de crecimiento economico aumenta en una unidad. 
En cuanto al modelo el porcentaje de explicacion es de 21.5%, medido a traves del R2 ajustado. El p-valor de la variable independiente es 2.47e-08, lo cual es menor a 0.05 y evidencia que el modelo es valido. 

Gráfico de la relación:
- En el gráfico se evidencia de mejor manera la relacion inversa de las variables. Los datos estan concentrados en un lugar especifico, con una mayor cantidad en torno a valores entre 0 y 0.1 de no afiliados, Se evidencia una tendencia descendente, de relación indirecta, es decir, valores menores de no afiliados evidencia mayor de índice de desigualdad de genéro.

- En otras palabras, mientras mayor sea el porcentaje de personas no afiliadas a religion alguna, menor seran las probabilidades de que el se evidencie desigualdad de genero en el pais respectivo. Por lo que decirmos que esta variable impacta significativamente con un 21.5%.


```{r}
ggplot(afigi, aes(x=Unaffiliated, y=GI)) + 
  geom_point()+
  geom_smooth(method=lm)
```


```{r}
DI$GI=as.numeric(DI$GI)
```

```{r}
junto=merge(demgi,cregi)
juntos=merge(junto,afigi)
str(juntos)
```

##MODELO 4
DEMOCRACIA Y CRECIMIENTO

```{r}
regresion4 <- lm(GI ~ ID + Growth, data = juntos)
summary(regresion4)
stargazer(regresion4, type="text")
model4=list('OLS asegurados (I)'=regresion4)
modelsummary(model4, title = "Regresion Lineal 4",
             stars = TRUE,
             output = "kableExtra")
```

```{r}
library(scatterplot3d)
G1 <- scatterplot3d(juntos[,c('ID','Growth','GI')])
G1$plane3d(regresion4, draw_polygon = TRUE, draw_lines = FALSE)
```

#INTERPRETACION 4-REGRESION DEMOCRACY + CRECIMIENTO

El modelo 4 tiene un porcentaje de explicacion es de 46.5%, medido a traves del R2 ajustado. Ambos p-valores son menores a 0.05 y se evidencia que el modelo es válido.

##MODELO 5
DEMOCRACIA Y NO AFILIADOS

```{r}
regresion5 <- lm(GI ~ ID + Unaffiliated, data = juntos)
summary(regresion5)
stargazer(regresion5, type="text")
```

```{r}
library(scatterplot3d)
G2 <- scatterplot3d(juntos[,c('ID','Unaffiliated','GI')])
G2$plane3d(regresion5, draw_polygon = TRUE, draw_lines = FALSE)
```

#INTERPRETACION 5-REGRESION DEMOCRACY + UNAFFILIATED

El modelo 5 tiene un porcentaje de explicacion es de 41.4%, medido a traves del R2 ajustado. Ambos p-valores son menores a 0.05 y se evidencia que el modelo es válido. En comparacion con el modelo 4, este modelo tiene un porcentaje de significancia ligeramente menor.

##MODELO 6
CRECIMIENTO Y NO AFILIADOS

```{r}
regresion6 <- lm(GI ~ Growth+ Unaffiliated, data = juntos)
summary(regresion6)
stargazer(regresion6, type="text")
```

```{r}
G3 <- scatterplot3d(juntos[,c('Growth','Unaffiliated','GI')])
G3$plane3d(regresion6, draw_polygon = TRUE, draw_lines = FALSE)
```

#INTERPRETACION 6-GROWTH + UNAFFILIATED

El modelo 6 tiene un porcentaje de explicacion es de 34.5%, medido a traves del R2 ajustado. Ambos p-valores son menores a 0.05 y se evidencia que el modelo es válido. En comparacion con el modelo 4 y 5, este modelo tiene un porcentaje de significancia menor. 

##MODELO 7
DEMOCRACIA, CRECIMIENTO Y NO AFILIADOS

```{r}
regresion7 <- lm(GI ~ ID + Growth + Unaffiliated, data = juntos)
summary(regresion7)
stargazer(regresion7, type="text")
```

```{r}
model7=list('OLS asegurados (I)'=regresion7)
modelsummary(model7, title = "Regresion Lineal 7",
             stars = TRUE,
             output = "kableExtra")
```

#INTERPRETACION 7-REGRESION DEMOCRACY + GROWTH + UNAFFILIATED
El modelo 7 tiene un porcentaje de explicacion es de 50.4%, medido a traves del R2 ajustado. Los p-valores de las variables son menores a 0.05 y se evidencia que el modelo es válido. En comparacion con los modelos anteriores, este modelo tiene un porcentaje de significancia mucho mayor. Por lo que la adicion de las variables tiene impacto.


```{r}
library(ggplot2)
library(sjPlot)

plot_models(regresion1,regresion2,regresion3,regresion4,regresion5,regresion6,regresion7,vline.color = "grey",m.labels=c("Modelo 1","Modelo 2","Modelo 3", "Modelo 4","Modelo 5","Modelo 6","Modelo 7"))
```

```{r}
anova(regresion7, test = "Chisq") %>%
kable(caption = "Tabla ANOVA ")%>%kableExtra::kable_styling(full_width = FALSE)
```

```{r}
par(mfrow = c(2, 2))  
plot(regresion7, 1,caption = '');title(main="Linealidad")
plot(regresion7, 2, caption = '');title(main="Normalidad")
plot(regresion7, 3, caption = '');title(main="Homocedasticidad")
plot(regresion7, 5, caption = '');title(main="Influyentes")
```
##INTERPRETACION DE SUPUESTOS

#LINEALIDAD
- Hay linelidad, se espera que esten cercanos a 0 y con una linea horizontal.La linea cuenta con una tendencia horizontal, los datos estan concentrados entre valores de 0.1 y 0.6 cercanos a 0

#HOMOCEDASTICIDAD
```{r}
library(lmtest)
bptest(regresion7)
```

- La linea es horizontal, pero el p-valor es menor a 0.05 y se requiere mayor. No se cumple el supuesto.


#NORMALIDAD DE RESIDUOS
```{r}
shapiro.test(regresion7$residuals)
```
- Los puntos se acercan mas a la línea del gráfico y el p-valor de la prueba ShapiroWilk es mayor a 0.05 por lo que hay normalidad de residuos.


#NO MULTICOLINEALIDAD
```{r}
library(DescTools)
VIF(regresion7)
```
- Los valores son menores a 5 por lo que cumple es supuesto.
